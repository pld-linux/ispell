diff -uNr ispell-3.1.orig/correct.c ispell-3.1/correct.c
--- ispell-3.1.orig/correct.c	Fri May  5 17:14:00 2000
+++ ispell-3.1/correct.c	Fri May  5 17:16:39 2000
@@ -1516,13 +1516,7 @@
 	 * all that likely).
 	 */
 	bufsize = strlen (contextbufs[0]);
-	if (contextbufs[0][bufsize - 1] == '\n')
-	    {
-	    hadnl = 1;
-	    contextbufs[0][--bufsize] = '\0';
-	    }
-	else
-	    hadnl = 0;
+	hadnl = (contextbufs[0][bufsize - 1] == '\n');
 	if (bufsize == (sizeof contextbufs[0]) / 2 - 1)
 	    {
 	    ch = (unsigned char) contextbufs[0][bufsize - 1];
@@ -1584,9 +1578,13 @@
 		}
 	    else if (contextbufs[0][0] == '~')
 		{
+		if (hadnl)
+		    contextbufs[0][bufsize - 1] = '\0';
 		defdupchar = findfiletype (&contextbufs[0][1], 1, (int *) NULL);
 		if (defdupchar < 0)
 		    defdupchar = 0;
+		if (hadnl)
+		    contextbufs[0][bufsize - 1] = '\n';
 		}
 	    else
 		{
diff -uNr ispell-3.1.orig/defmt.c ispell-3.1/defmt.c
--- ispell-3.1.orig/defmt.c	Fri May  5 17:14:00 2000
+++ ispell-3.1/defmt.c	Fri May  5 17:16:39 2000
@@ -732,7 +732,7 @@
 	   (void) fprintf (ofile, "%s", ctoken);
 	}
 
-    if (!lflag  &&  (aflag  ||  hadlf))
+    if (!lflag  && hadlf)
        (void) putc ('\n', ofile);
    }
 
@@ -772,6 +772,8 @@
 	return 0;
     }
 
+/* Updates bufp to point to the next character to skip. */
+/*  Should only be called on non-word characters. */
 static int TeX_math_begin (bufp)
     char **	bufp;
     {
@@ -788,10 +790,7 @@
 	if (**bufp == TEXLEFTPAREN  ||  **bufp == TEXLEFTSQUARE)
 	    return 1;
 	else if (!isalpha(**bufp)  &&  **bufp != '@')
-	    {
-	    (*bufp)++;
-	    continue;
-	    }
+	    return 0;
 	else if (TeX_strncmp (*bufp, "begin", 5) == 0)
 	    {
 	    if (TeX_math_check ('b', bufp))
@@ -821,12 +820,10 @@
 	    {
 	    if (*(*bufp)++ == TEXDOT
 	      &&  (**bufp == TEXRIGHTSQUARE  ||  **bufp == TEXRIGHTANGLE))
-		return TeX_math_begin (bufp);
+		break;
 	    }
-	return 0;
 	}
-    else
-	return 0;
+    return 0;
     }
 
 static int TeX_LR_begin (bufp)
diff -uNr ispell-3.1.orig/version.h ispell-3.1/version.h
--- ispell-3.1.orig/version.h	Thu Oct 12 15:04:46 1995
+++ ispell-3.1/version.h	Fri May  5 17:16:39 2000
@@ -8,7 +8,7 @@
  */
 
 static char * Version_ID[] = {
-    "@(#) International Ispell Version 3.1.20 10/10/95",
+    "@(#) International Ispell Version 3.1.20 10/10/95, patch 1",
     "@(#) Copyright (c), 1983, by Pace Willisson",
     "@(#) International version Copyright (c) 1987, 1988, 1990-1995,",
     "@(#) by Geoff Kuenning, Granada Hills, CA.  All rights reserved.",
